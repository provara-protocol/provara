<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Provara Backpack Protocol v1.0 — Specification</title>
<style>
:root {
  --bg: #0d1117;
  --bg-raised: #161b22;
  --border: #30363d;
  --text: #e6edf3;
  --text-dim: #8b949e;
  --green: #3fb950;
  --blue: #58a6ff;
  --mono: 'SF Mono', 'Cascadia Code', 'Fira Code', 'JetBrains Mono', monospace;
  --sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
}

@media print {
  :root {
    --bg: #fff;
    --text: #000;
    --border: #ccc;
    --green: #000;
    --blue: #000;
  }
  body { font-size: 11pt; }
  .no-print { display: none; }
}

body {
  font-family: var(--sans);
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  max-width: 900px;
  margin: 0 auto;
  padding: 40px 20px;
}

h1, h2, h3, h4 { font-family: var(--mono); color: var(--green); margin-top: 2em; }
h1 { font-size: 2.5em; border-bottom: 2px solid var(--border); padding-bottom: 10px; }
h2 { font-size: 1.8em; border-bottom: 1px solid var(--border); padding-bottom: 5px; }

code, pre { font-family: var(--mono); background: var(--bg-raised); border-radius: 6px; }
code { padding: 0.2em 0.4em; font-size: 0.9em; }
pre { padding: 16px; overflow: auto; border: 1px solid var(--border); }

table { width: 100%; border-collapse: collapse; margin: 20px 0; }
th, td { border: 1px solid var(--border); padding: 12px; text-align: left; }
th { background: var(--bg-raised); }

.status-box {
  background: rgba(63, 185, 80, 0.1);
  border: 1px solid var(--green);
  padding: 15px;
  border-radius: 8px;
  margin: 20px 0;
}

.toc {
  background: var(--bg-raised);
  padding: 20px;
  border-radius: 8px;
  border: 1px solid var(--border);
}

.toc ul { list-style: none; padding-left: 0; }
.toc li { margin-bottom: 8px; }
.toc a { color: var(--blue); text-decoration: none; }
.toc a:hover { text-decoration: underline; }

a { color: var(--blue); }

footer {
  margin-top: 100px;
  border-top: 1px solid var(--border);
  padding-top: 20px;
  font-size: 0.9em;
  color: var(--text-dim);
  text-align: center;
}
</style>
</head>
<body>

<header>
  <h1>Provara Backpack Protocol v1.0</h1>
  <div class="status-box">
    <strong>Profile:</strong> <code>PROVARA-1.0_PROFILE_A</code><br>
    <strong>Status:</strong> Normative Reference Specification<br>
    <strong>Date:</strong> 2026-02-16
  </div>
</header>

<section class="toc no-print">
  <h3>Table of Contents</h3>
  <ul>
    <li><a href="#purpose">1. Purpose</a></li>
    <li><a href="#concepts">2. Concepts and Vocabulary</a></li>
    <li><a href="#crypto">3. Cryptographic Stack</a></li>
    <li><a href="#canonical">4. Canonical JSON</a></li>
    <li><a href="#identity">5. Event Identity</a></li>
    <li><a href="#causal">6. Causal Chain</a></li>
    <li><a href="#types">7. Event Types</a></li>
    <li><a href="#reducer">8. The Reducer</a></li>
    <li><a href="#keymgmt">9. Key Management</a></li>
    <li><a href="#merkle">10. Merkle Tree</a></li>
    <li><a href="#manifest">11. Manifest</a></li>
    <li><a href="#safety">12. Safety Tiers</a></li>
    <li><a href="#sync">13. Sync Protocol</a></li>
    <li><a href="#permanence">14. Event Permanence</a></li>
    <li><a href="#directory">15. Directory Structure</a></li>
    <li><a href="#compliance">16. Compliance Requirements</a></li>
    <li><a href="#security">17. Security Considerations</a></li>
  </ul>
</section>

<main>
  <h2 id="purpose">1. Purpose</h2>
  <p>The Backpack Protocol defines a tamper-evident, append-only memory substrate for AI systems, sovereign identity, and long-lived digital institutions. A backpack (vault) is a directory of signed events. Given the same event log, any compliant implementation on any machine must produce byte-identical state.</p>
  <p><strong>Design axiom:</strong> <em>Truth is not merged. Evidence is merged. Truth is recomputed.</em></p>

  <h2 id="concepts">2. Concepts and Vocabulary</h2>
  <table>
    <tr><th>Term</th><th>Definition</th></tr>
    <tr><td><strong>Vault / Backpack</strong></td><td>A directory containing a compliant event log, identity files, policies, and manifest.</td></tr>
    <tr><td><strong>Event</strong></td><td>An immutable, content-addressed JSON record appended to the event log.</td></tr>
    <tr><td><strong>Actor</strong></td><td>The identity that authored an event (identified by <code>actor_key_id</code>).</td></tr>
    <tr><td><strong>Namespace</strong></td><td>One of four epistemic buckets: <code>canonical</code>, <code>local</code>, <code>contested</code>, <code>archived</code>.</td></tr>
    <tr><td><strong>Reducer</strong></td><td>The pure function <code>f(events) → state</code> that deterministically produces beliefs.</td></tr>
  </table>

  <h2 id="crypto">3. Cryptographic Stack</h2>
  <p>All Profile A implementations MUST use exactly this stack:</p>
  <ul>
    <li><strong>Hashing:</strong> SHA-256 (FIPS 180-4)</li>
    <li><strong>Signing:</strong> Ed25519 (RFC 8032)</li>
    <li><strong>Serialization:</strong> RFC 8785 Canonical JSON</li>
  </ul>

  <h2 id="canonical">4. Canonical JSON</h2>
  <p>All hashing and signing MUST use RFC 8785 canonical JSON. Rules include:</p>
  <ol>
    <li>Object keys sorted lexicographically by Unicode code point.</li>
    <li>No whitespace between tokens.</li>
    <li>Numbers formatted without leading zeros or positive signs.</li>
    <li>UTF-8 encoding without BOM.</li>
  </ol>

  <h2 id="identity">5. Event Identity</h2>
  <p>Events are content-addressed. Derivation rule:</p>
  <pre>event_id = "evt_" + SHA-256(canonical_bytes(event_without_id_and_sig))[:24 hex chars]</pre>

  <h2 id="causal">6. Causal Chain</h2>
  <p>Each actor maintains a per-actor linked list via <code>prev_event_hash</code>. The first event MUST have <code>null</code> as the previous hash.</p>

  <h2 id="types">7. Event Types</h2>
  <p>Core types include: <code>GENESIS</code>, <code>OBSERVATION</code>, <code>ASSERTION</code>, <code>ATTESTATION</code>, <code>RETRACTION</code>, <code>KEY_REVOCATION</code>, <code>KEY_PROMOTION</code>.</p>

  <h2 id="reducer">8. The Reducer</h2>
  <p>The reducer is a pure function: <code>f(events) → state</code>. It populates four namespaces:</p>
  <ul>
    <li><code>canonical/</code>: Attested institutional truth.</li>
    <li><code>local/</code>: Unverified observations.</li>
    <li><code>contested/</code>: Conflicting evidence.</li>
    <li><code>archived/</code>: Superseded beliefs.</li>
  </ul>

  <h2 id="compliance">16. Compliance Requirements</h2>
  <p>A compliant implementation MUST pass the 17 core compliance tests covering directory structure, causal integrity, Merkle verification, and reducer determinism.</p>

  <h2 id="security">17. Security Considerations</h2>
  <p>The protocol protects against data tampering and history re-ordering through cryptographic chaining. It provides integrity and authenticity, but confidentiality MUST be handled at the application layer via encryption.</p>
</main>

<footer>
  &copy; 2026 Hunt Information Systems LLC. Provara is an Apache 2.0 licensed open-source protocol.
</footer>

</body>
</html>
